const CACHE_NAME = 'hsc2026-cache-v1'; const urlsToCache = [ '/', '/index.html', '/manifest.json', '/service-worker.js', 'https://cdn.jsdelivr.net/npm/chart.js', 'https://www.soundjay.com/buttons/sounds/beep-07.mp3' ]; self.addEventListener('install', event => { event.waitUntil(caches.open(CACHE_NAME).then(cache => cache.addAll(urlsToCache))); self.skipWaiting(); }); self.addEventListener('fetch', event => { event.respondWith(caches.match(event.request).then(response => response || fetch(event.request))); }); self.addEventListener('activate', event => { const cacheWhitelist = [CACHE_NAME]; event.waitUntil(caches.keys().then(keyList => { return Promise.all(keyList.map(key => { if (!cacheWhitelist.includes(key)) return caches.delete(key); })); }).then(() => self.clients.claim())); }); self.addEventListener('message', event => { if(event.data && event.data.type === 'CHECK_FOR_UPDATE'){ self.skipWaiting(); self.clients.matchAll().then(clients => { clients.forEach(client => client.postMessage({ type: 'NEW_VERSION_AVAILABLE' })); }); } }); 